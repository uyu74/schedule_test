"use strict";const e=require("../../common/vendor.js"),t={data:()=>({schedules:[],scheduleOnShow:"",weeklySchedule:[],weeklyDate:[],currentWeek:1,pageSize:20,total:400}),onLoad(){this.getSchedulesFromStorage(),this.getCurrentWeek()},methods:{weekChange(e){this.$refs.table.clearSelection(),console.log("当前页:",e.current),this.currentWeek=e.current},getSchedulesFromStorage(){const t=e.index.getStorageSync("schedules");t&&(this.schedules=t,this.scheduleOnShow=this.schedules[0],this.preprocessWeeklySchedule())},getCurrentWeek(){const e=new Date,t=new Date(this.scheduleOnShow.date);if(1!==t.getDay())return void console.error("请确保选择的日期是周一");console.log("选择的日期是周一");const n=(e-t)/864e5;this.currentWeek=Math.ceil(n/7),console.log("当前周数：",this.currentWeek)},manageSchedules(){e.index.navigateTo({url:"/pages/schedule_list/schedule_list"})},initializeWeeklySchedule(){this.weeklySchedule=new Array(20).fill(null).map((()=>new Array(5).fill(null).map((()=>new Array(7).fill(null))))),this.weeklyDate=new Array(20).fill(null).map((()=>new Array(7).fill(null)));const e=new Date(this.scheduleOnShow.date);e.setHours(0,0,0,0),this.weeklyDate.forEach(((t,n)=>{t.forEach(((t,s)=>{const o=new Date(e);o.setDate(e.getDate()+7*n+s),this.weeklyDate[n][s]=(o.getMonth()+1).toString().padStart(2,"0")+"-"+o.getDate().toString().padStart(2,"0")}))}))},preprocessWeeklySchedule(){this.initializeWeeklySchedule(),this.getCurrentWeek(),this.scheduleOnShow.course.forEach((e=>{e.week.forEach((t=>{this.weeklySchedule[t-1][e.classTime-1][e.weekDay-1]=e}))})),console.log("课程日期:",this.weeklyDate),console.log("每周课程表:",this.weeklySchedule)},getDayOfWeek:e=>["星期一","星期二","星期三","星期四","星期五","星期六","星期日"][e-1],changeScheduleOnShow(e){console.log("原先的课程表：",this.scheduleOnShow),this.scheduleOnShow=e,console.log("选中的课程表:",this.scheduleOnShow),this.preprocessWeeklySchedule(),console.log("每周课程表:",this.weeklySchedule)},getSchedulesFromStorage(){try{const t=e.index.getStorageSync("schedules");t?(this.schedules=JSON.parse(t),this.schedules.length>0&&(this.scheduleOnShow=this.schedules.reduce(((e,t)=>t.index<e.index?t:e)),this.preprocessWeeklySchedule(),console.log("选中的课程表:",this.scheduleOnShow))):console.log("未找到课程数据")}catch(t){console.error("Error parsing schedules from storage:",t),this.schedules=[]}},showDrawer(e){this.$refs[e].open()},closeDrawer(e){this.$refs[e].close()},change(e,t){console.log(("showLeft"===t?"左":"右")+"侧栏状态："+(e?"显示":"收起"))},onNavigationBarButtonTap(e){this.showLeft?this.$refs.showLeft.close():this.$refs.showLeft.open()}}};if(!Array){(e.resolveComponent("uni-list-item")+e.resolveComponent("uni-list")+e.resolveComponent("uni-drawer")+e.resolveComponent("uni-th")+e.resolveComponent("uni-tr")+e.resolveComponent("uni-td")+e.resolveComponent("uni-table")+e.resolveComponent("uni-pagination"))()}Math||((()=>"../../uni_modules/uni-list/components/uni-list-item/uni-list-item.js")+(()=>"../../uni_modules/uni-list/components/uni-list/uni-list.js")+(()=>"../../uni_modules/uni-drawer/components/uni-drawer/uni-drawer.js")+(()=>"../../uni_modules/uni-table/components/uni-th/uni-th.js")+(()=>"../../uni_modules/uni-table/components/uni-tr/uni-tr.js")+(()=>"../../uni_modules/uni-table/components/uni-td/uni-td.js")+(()=>"../../uni_modules/uni-table/components/uni-table/uni-table.js")+(()=>"../../uni_modules/uni-pagination/components/uni-pagination/uni-pagination.js"))();const n=e._export_sfc(t,[["render",function(t,n,s,o,l,c){return{a:e.f(l.schedules,((t,n,s)=>({a:n,b:e.o((e=>c.changeScheduleOnShow(t)),n),c:"4ac24ec4-2-"+s+",4ac24ec4-1",d:e.p({title:t.name,clickable:!0})}))),b:e.o(((...e)=>c.manageSchedules&&c.manageSchedules(...e))),c:e.o((e=>c.closeDrawer("showLeft"))),d:e.sr("showLeft","4ac24ec4-0"),e:e.o((e=>c.change(e,"showLeft"))),f:e.p({mode:"left",width:320}),g:e.p({width:"20",align:"center"}),h:e.f(l.weeklyDate[l.currentWeek-1],((t,n,s)=>({a:e.t(c.getDayOfWeek(n+1)),b:e.t(t),c:n,d:"4ac24ec4-6-"+s+",4ac24ec4-4"}))),i:e.p({align:"center",width:"52"}),j:e.f(l.weeklySchedule[l.currentWeek-1],((t,n,s)=>({a:e.t(n+1),b:"4ac24ec4-8-"+s+",4ac24ec4-7-"+s,c:e.f(t,((t,n,o)=>e.e({a:t},t?{b:e.t(t.name),c:e.t(t.room),d:e.t(t.teacher)}:{},{e:n,f:"4ac24ec4-9-"+s+"-"+o+",4ac24ec4-7-"+s}))),d:n,e:"4ac24ec4-7-"+s+",4ac24ec4-3"}))),k:e.p({align:"center"}),l:e.p({align:"center"}),m:e.sr("table","4ac24ec4-3"),n:e.p({loading:t.loading,border:!0,stripe:!0,emptyText:"暂无更多数据"}),o:e.o(c.weekChange),p:e.p({"show-icon":!0,"page-size":l.pageSize,current:l.currentWeek,total:l.total}),q:e.o((e=>c.showDrawer("showLeft")))}}],["__scopeId","data-v-4ac24ec4"]]);wx.createPage(n);
